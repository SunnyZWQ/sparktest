

#### AIOps概述

- 异常检测
- 异常定位
- 根因分析
- 异常预测


#### AIOps不能直接用标准的机器学习算法来解决，因为AIOps在实际应用中会面临很多挑战：漏报误报多、故障发现不及时、数据缺失，因此设置静态阈值是不能满足需求的。


**很多时序分析的算法，理论上可以做异常预测，但是往往适用场景不明确。**

另外，对于数据缺失的情况，处理不当就会导致异常检测率很低。

因此，一种常出现的情况是：上周出现了误报，本周就调整一下阈值，但是根据这一个个case来决定静态阈值的话，容易丢西瓜捡芝麻，导致出现新的、可能是更严重的误报漏报。

还有，以往有算法解决了算法上述普适性问题，但是基于监督学习的。可是，在实践中，异常标注难以批量获得，只有一些零星的case。如果让业务人员去进行标注的话，会非常麻烦，因为他们只有一些历史的case。而标注一条KPI曲线，往往需要反反复复调整矫正，耗时耗力。


另外一个挑战是，你可能需要同时开始监控几百万、几千万的KPI，怎么快速给他们选择算法呢？另外，可能一条曲线的模式经过一次软件变更之后发生巨变，算法参数就失效了，导致出现大量的误报。


 最后的结论是，任何一个算法都无法同时解决上面的挑战。


AI可以解决不少问题，但是它目前的能力是有一定的范围的。人工智能在解决很多类型问题时不管多么复杂都能做到，甚至超过人类的水平。这些问题的特点是什么呢？有充足的数据和知识，问题定义很清楚，已经明确了输入输出是什么，以及单领域。我们回过头来看上面我们的“异常检测”问题，我们基本可以体会到要想一步到位解决异常检测的所有挑战，是不现实的，因为这个整体问题已经复杂到AI不擅长解决的程度。



## AIOps落地步骤

### 1、做一个无监督的异常检测

标注数据很难大批量获得，那么先做一个无监督的异常检测作为初筛，将数据进行分类，再由运维专家对分类的数据进行标注，这样一次标注可以起到举一反百甚至举一反千的效果。使得标注工作充分利用，标注开销非常低。

之后可以采用已有的 有监督的异常检测，解决算法和参数的普适性问题。

同时，如果遇到右下子图的那个KPI曲线的模式的突变的话，我们首先判断新模式是否跟老模式属于同一类型，然后自动通过迁移学习自动调整算法参数。最后，如左下子图所示，为了对大量的KPI自动地分配检测算法， 我们先把海量的KPI进行分类。即使有几百万条曲线，其类别也不会太多。我们在每一类里面找到典型的算法，然后对同一类里的每根曲线进行微调。


![](http://ww1.sinaimg.cn/large/005N2p5vly1ftjut1w7oxj30zz0jzao1.jpg)


### 故障止损——异常定位的粒度足够采用止损预案即可


当业务指标发生剧烈波动时，我们找到该业务的哪些模块的哪些指标也同时发生了波动，并根据关联程度进行排序，给出最可能的根因位置，供运维人员进行定位。在左中子图中，一个不完善组粒度的故障树也能起到故障定位的效果。另外，还可以对故障进行最粗粒度的故障定界，确定是网络、服务器、存储、还是用户的问题，快速明确责任单位，便于止损，如右下子图所示。最后，还可以判断故障是否为容量不足导致，以便迅速做出动态扩容决策。


### 故障修复：根因分析（异常检测+故障树构建）

根因分析的前提是报警（要求异常检测部分要报准），下一步就是构建故障树。由于软件模块之间的依赖关系太复杂，因此故障树的构建非常难。对所有的报警信息进行两两关联的计算量过大。**一种思路是构建一个故障树的超集，通过模块调用链获得模块之间的逻辑调用关系，通过配置信息获得物理模块之间的物理关联，比如共享机器资源、网络资源等。这两部分一起构成一个可能的故障树，这棵树是真正故障树的一个超集**。之后我们对这个超集中的每个边进行联动分析，对这棵树进行剪枝，构成最终的故障传播关系。这种方法的覆盖面广，计算开销大大降低，并且是AI擅长解决的问题。当我们拥有了故障传播关系，并它比较全而且准的话，根因分析就变得可行了。当发生故障时，依据准确的报警， 顺着故障传播树就能找到根因，从而进行故障修复。


### 故障规避：异常预测

![](http://ww1.sinaimg.cn/large/005N2p5vly1ftlvqbazotj30zk0gqame.jpg)

性能瓶颈预测、容量预测、故障预测等异常预测是故障规避的经典场景，如上图所示。 性能瓶颈被预测出来后，比如发现哪个模块是整个系统性能的瓶颈，就可以对这部分进行代码优化，如果代码优化来不及的话，也可以选择定向扩容。容量预测之后，可以进行动态的扩缩容、资源预算等，比如当业务需要达到每秒三十万笔交易时，也许不用统一的全面的扩容，只需要把瓶颈部分的容量扩展。故障预测可以帮助进行动态的切流量、替换硬件等等。





### 顶级会议


![](http://ww1.sinaimg.cn/large/005N2p5vly1ftjyl703ofj30gg0afwj7.jpg)

值得各位运维界同仁们关注的就是学术界的顶级会议，我比较推荐的是上面图中的这些会议，这些会基本上一年三五十篇论文的样子，简单浏览一下，跟大家做得工作是不是相关，浏览一下最新的会议论文集，看看有没有相关的，还是很有帮助的。美国的工业界，像谷歌、Facebook都已经在这些会议上发表过一些论文，包括他们在工程上的一些实践。


如何更系统的应用机器学习技术。机器学习纷繁复杂，简单说一下。特征选取的时候，早期可以用一些全部数据+容忍度高的算法，如随机森林，还有特征工程、自动选取（深度学习）；不同机器学习算法适用不同的问题；一个比较行之有效的方法，大家做日常运维过程中，可以跟学术界进行具体探讨，针对眼前问题一起探讨一下，可能比较容易找到适合的起点。工业界跟学术界针对具体问题进行密切合作是一个有效的策略。


http://blog.tingyun.com/web/article/detail/1108

